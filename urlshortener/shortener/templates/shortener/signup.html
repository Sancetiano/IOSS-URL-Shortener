{% extends 'shortener/base.html' %}

{% block title %}Sign Up - URL Shortener{% endblock %}

{% block extra_head %}
    <script>
        function validateSignup(event) {
            event.preventDefault();
            const form = document.getElementById('signup-form');
            const username = document.getElementById('id_username');
            const password1 = document.getElementById('id_password1');
            const password2 = document.getElementById('id_password2');
            const errorDiv = document.getElementById('signup-errors');
            errorDiv.innerHTML = '';

            let errors = [];
            if (!username.value) {
                errors.push('Username is required.');
                username.classList.add('error');
            } else {
                username.classList.remove('error');
            }
            if (password1.value.length < 8) {
                errors.push('Password must be at least 8 characters long.');
                password1.classList.add('error');
            } else {
                password1.classList.remove('error');
            }
            if (password1.value !== password2.value) {
                errors.push('Passwords do not match.');
                password2.classList.add('error');
            } else {
                password2.classList.remove('error');
            }

            if (errors.length > 0) {
                errorDiv.classList.remove('hidden');
                errors.forEach(error => {
                    const p = document.createElement('p');
                    p.className = 'text-red-600 text-sm';
                    p.textContent = error;
                    errorDiv.appendChild(p);
                });
                return false;
            }

            form.submit();
        }
    </script>
{% endblock %}

{% block content %}
    <div class="flex items-center justify-center min-h-full">
        <div class="bg-white p-8 rounded-lg shadow-lg w-full max-w-md">
            <h2 class="text-2xl font-semibold mb-6 text-center">Sign Up</h2>
            {% if messages %}
                {% for message in messages %}
                    <div class="bg-{{ message.tags }}-100 border-l-4 border-{{ message.tags }}-500 text-{{ message.tags }}-700 p-4 mb-6 rounded" role="alert">
                        {{ message }}
                    </div>
                {% endfor %}
            {% endif %}
            <form id="signup-form" method="post" onsubmit="validateSignup(event)">
                {% csrf_token %}
                <div class="space-y-5">
                    <div>
                        <label for="id_username" class="block text-sm font-medium text-gray-700 mb-1">Username</label>
                        {{ form.username }}
                    </div>
                    <div>
                        <label for="id_password1" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                        {{ form.password1 }}
                    </div>
                    <div>
                        <label for="id_password2" class="block text-sm font-medium text-gray-700 mb-1">Confirm Password</label>
                        {{ form.password2 }}
                    </div>
                    <div id="signup-errors" class="hidden"></div>
                    <button type="submit" class="w-full bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition duration-200">Sign Up</button>
                </div>
            </form>
            <p class="mt-6 text-center text-sm text-gray-600">
                Already have an account? <a href="{% url 'login' %}" class="text-blue-500 hover:underline">Login</a>
            </p>
            <p class="mt-2 text-center text-sm text-gray-600">
                <a href="{% url 'home' %}" class="text-blue-500 hover:underline">Back to Home</a>
            </p>
        </div>
    </div>
{% endblock %}